<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>app &mdash; Nutra Backend 1.0.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            Nutra Backend
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../modules.html">backend</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Nutra Backend</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">app</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for app</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">render_template</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">jsonify</span>
<span class="kn">from</span> <span class="nn">flask_sqlalchemy</span> <span class="kn">import</span> <span class="n">SQLAlchemy</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.orm</span> <span class="kn">import</span> <span class="n">relationship</span> 
<span class="kn">from</span> <span class="nn">flask_cors</span> <span class="kn">import</span> <span class="n">CORS</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">random</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span><span class="p">,</span> <span class="n">DateTime</span><span class="p">,</span> <span class="n">func</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;postgresql://postgres:admin@localhost/capstone&#39;</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">SQLAlchemy</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>
<span class="n">CORS</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="c1"># spoonacular api key</span>
<span class="n">api_key</span> <span class="o">=</span> <span class="s2">&quot;13cc54269ca54d258cf7b07e4383154c&quot;</span>

<div class="viewcode-block" id="User"><a class="viewcode-back" href="../app.html#app.User">[docs]</a><span class="k">class</span> <span class="nc">User</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a SQLAlchemy table for storing user data.</span>

<span class="sd">    :param db: A SQLAlchemy database object.</span>

<span class="sd">    :return: A SQLAlchemy table object representing the User table.</span>
<span class="sd">    :rtype: SQLAlchemy table object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users_table&#39;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">}</span>
    
    <span class="n">nutrition</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;UserNutrition&quot;</span><span class="p">)</span>
    <span class="n">grocery_lists</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s2">&quot;GroceryLists&quot;</span><span class="p">)</span>

    <span class="c1"># user auth</span>
    <span class="n">userID</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">,</span> <span class="n">nullable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">created_on</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">DateTime</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">func</span><span class="o">.</span><span class="n">now</span><span class="p">())</span>

    <span class="c1"># user body info</span>
    <span class="n">gender</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
    <span class="n">weight_lbs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">height_feet</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">height_inches</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">activity_level</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>

    <span class="c1"># user dietary</span>
    <span class="n">vegetarian</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">)</span>
    <span class="n">vegan</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">)</span>
    <span class="n">gluten_free</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">)</span>
    <span class="n">keto</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">)</span>
    <span class="n">paleo</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">)</span>
    <span class="n">pescetarian</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">)</span>

    <span class="c1"># user preferences</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>

    <span class="c1"># user restrictions/allergies</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">username</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">password</span> <span class="o">=</span> <span class="n">password</span></div>
    
    <span class="c1">#def __init__(self, username, email, password, gender, weight_lbs, age, height_feet, height_inches, activity_level, vegetarian, vegan, gluten_free, keto, paleo, pescetarian, preferences, restricitons):</span>
    <span class="c1">#     self.username = username</span>
    <span class="c1">#     self.email = email</span>
    <span class="c1">#     self.password = password</span>
    <span class="c1">#     self.gender = gender</span>
    <span class="c1">#     self.weight_lbs = weight_lbs</span>
    <span class="c1">#     self.age = age</span>
    <span class="c1">#     self.height_feet = height_feet</span>
    <span class="c1">#     self.height_inches = height_inches</span>
    <span class="c1">#     self.activity_level=activity_level</span>
    <span class="c1">#     self.vegetarian = vegetarian</span>
    <span class="c1">#     self.vegan = vegan</span>
    <span class="c1">#     self.gluten_free = gluten_free</span>
    <span class="c1">#     self.keto = keto</span>
    <span class="c1">#     self.paleo = paleo</span>
    <span class="c1">#     self.pescetarian = pescetarian</span>
    <span class="c1">#     self.preferences = preferences</span>
   <span class="c1">#      self.restrictions = restricitons</span>
  

<div class="viewcode-block" id="UserNutrition"><a class="viewcode-back" href="../app.html#app.UserNutrition">[docs]</a><span class="k">class</span> <span class="nc">UserNutrition</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a SQLAlchemy table for storing user nutrition data.</span>

<span class="sd">    :param db: A SQLAlchemy database object.</span>

<span class="sd">    :return: A SQLAlchemy table object representing the UserNutrition table.</span>
<span class="sd">    :rtype: SQLAlchemy table object</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users_nutrition_table&#39;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">}</span>
    <span class="n">nutritionID</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">userID</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;public.users_table.userID&#39;</span><span class="p">))</span>
    <span class="c1">#user_nutrition = relationship(&quot;User&quot;)</span>


    <span class="n">energy</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">fat</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">carbs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>

    <span class="n">calcium</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">iron</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">potassium</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    
    <span class="n">calcium_ul</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">iron_ul</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>

    <span class="n">vitD</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">vitC</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">vitA</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">vitE</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    
    <span class="n">vitD_ul</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">vitC_ul</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">vitA_ul</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>
    <span class="n">vitE_ul</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">userID</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span> <span class="n">fat</span><span class="p">,</span> <span class="n">carbs</span><span class="p">,</span> <span class="n">calcium</span><span class="p">,</span> <span class="n">iron</span><span class="p">,</span> <span class="n">potassium</span><span class="p">,</span> <span class="n">calcium_ul</span><span class="p">,</span> <span class="n">iron_ul</span><span class="p">,</span> <span class="n">vitA</span><span class="p">,</span> <span class="n">vitD</span><span class="p">,</span><span class="n">vitC</span><span class="p">,</span><span class="n">vitE</span><span class="p">,</span> <span class="n">vitA_ul</span><span class="p">,</span> <span class="n">vitD_ul</span><span class="p">,</span><span class="n">vitC_ul</span><span class="p">,</span><span class="n">vitE_ul</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">energy</span> <span class="o">=</span> <span class="n">energy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protein</span> <span class="o">=</span> <span class="n">protein</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fat</span> <span class="o">=</span> <span class="n">fat</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">carbs</span> <span class="o">=</span> <span class="n">carbs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcium</span> <span class="o">=</span> <span class="n">calcium</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iron</span> <span class="o">=</span> <span class="n">iron</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">potassium</span> <span class="o">=</span> <span class="n">potassium</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calcium_ul</span><span class="o">=</span><span class="n">calcium_ul</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">iron_ul</span> <span class="o">=</span> <span class="n">iron_ul</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitA</span> <span class="o">=</span> <span class="n">vitA</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitD</span> <span class="o">=</span> <span class="n">vitD</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitC</span> <span class="o">=</span> <span class="n">vitC</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitE</span> <span class="o">=</span> <span class="n">vitE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitA_ul</span> <span class="o">=</span> <span class="n">vitA_ul</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitD_ul</span> <span class="o">=</span> <span class="n">vitD_ul</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitC_ul</span> <span class="o">=</span> <span class="n">vitC_ul</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vitE_ul</span> <span class="o">=</span> <span class="n">vitE_ul</span></div>


<div class="viewcode-block" id="WeeklyRecipes"><a class="viewcode-back" href="../app.html#app.WeeklyRecipes">[docs]</a><span class="k">class</span> <span class="nc">WeeklyRecipes</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a SQLAlchemy table for storing recipes the user chooses every week.</span>

<span class="sd">    :param db: A SQLAlchemy database object.</span>

<span class="sd">    :return: A SQLAlchemy table object representing the WeeklyRecipes table.</span>
<span class="sd">    :rtype: SQLAlchemy table object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;users_weekly_recipes_table&#39;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">}</span>

    <span class="c1">#grocery_lists = relationship(&quot;GroceryLists&quot;)</span>
    
    <span class="n">week_number_ID</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">userID</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;public.users_table.userID&#39;</span><span class="p">))</span>
    <span class="n">recipeIDs</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span> <span class="c1"># this is a string of comma-separated recipe IDs</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;User: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">userID</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">web_week_number</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">recipeIDs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">recipeIDs</span> <span class="o">=</span> <span class="n">recipeIDs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_week_number</span> <span class="o">=</span> <span class="n">web_week_number</span></div>


<div class="viewcode-block" id="Latency"><a class="viewcode-back" href="../app.html#app.Latency">[docs]</a><span class="k">class</span> <span class="nc">Latency</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a SQLAlchemy table for storing the latency data of backend functions.</span>

<span class="sd">    :param db: A SQLAlchemy database object.</span>

<span class="sd">    :return: A SQLAlchemy table object representing the Latency table.</span>
<span class="sd">    :rtype: SQLAlchemy table object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;latency_table&#39;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">}</span>

    <span class="n">function_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">function_name</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>
    <span class="n">time_taken_s</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Float</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Function ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">function_id</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">time_taken_s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">function_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_taken_s</span> <span class="o">=</span> <span class="n">time_taken_s</span></div>

<div class="viewcode-block" id="GroceryLists"><a class="viewcode-back" href="../app.html#app.GroceryLists">[docs]</a><span class="k">class</span> <span class="nc">GroceryLists</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a SQLAlchemy table for storing the weekly grocery lists for the user.</span>

<span class="sd">    :param db: A SQLAlchemy database object.</span>

<span class="sd">    :return: A SQLAlchemy table object representing the GroceryLists table.</span>
<span class="sd">    :rtype: SQLAlchemy table object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">__tablename__</span> <span class="o">=</span> <span class="s1">&#39;grocery_lists_table&#39;</span>
    <span class="n">__table_args__</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;schema&#39;</span><span class="p">:</span> <span class="s1">&#39;public&#39;</span><span class="p">}</span>

    <span class="n">listID</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="c1">#week_number_ID = db.Column(db.Integer, db.ForeignKey(&#39;public.users_weekly_recipes_table.week_number_ID&#39;))</span>
    <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">)</span>
    <span class="n">userID</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s1">&#39;public.users_table.userID&#39;</span><span class="p">))</span>
    <span class="n">grocery_list</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">)</span>


    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;List ID: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">listID</span><span class="si">}</span><span class="s2">&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">web_week_number</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">grocery_list</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span>
        <span class="c1">#self.week_number_ID = week_number_ID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">grocery_list</span> <span class="o">=</span> <span class="n">grocery_list</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">web_week_number</span> <span class="o">=</span><span class="n">web_week_number</span></div>

<div class="viewcode-block" id="home"><a class="viewcode-back" href="../app.html#app.home">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">home</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This is a function that returns the root path.</span>

<span class="sd">    :return: An empty page saying &quot;Test Page.&quot;</span>
<span class="sd">    :rtype: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s2">&quot;Test Page&quot;</span></div>


<div class="viewcode-block" id="post_recipes"><a class="viewcode-back" href="../app.html#app.post_recipes">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post_recipes/&lt;userID&gt;/&lt;weekID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span><span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">post_recipes</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">weekID</span><span class="p">):</span>
    <span class="n">userID</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;userID&#39;</span><span class="p">)</span>
    <span class="n">recipe_string</span><span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;recipe_string&#39;</span><span class="p">)</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="p">(</span><span class="n">weekID</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">recipe_string</span><span class="p">)</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">recipes</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    
    <span class="c1"># post grocery list</span>
    <span class="n">recipe_ids</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">,</span> <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="p">(</span><span class="n">recipe_ids</span><span class="o">.</span><span class="n">recipeIDs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    
    <span class="n">num_recipes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recipes</span><span class="p">)</span>
    
    <span class="n">recipe_ingredients_info_json</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="n">find_by_nutrients_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/</span><span class="si">{id}</span><span class="s2">/ingredientWidget.json?apiKey=13cc54269ca54d258cf7b07e4383154c&quot;</span>
    
    <span class="n">grocery_list_map</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1">#grocery_list_map[&quot;id&quot;] = weekID</span>
    
    <span class="k">for</span> <span class="n">recipe</span> <span class="ow">in</span> <span class="n">recipes</span><span class="p">:</span>
        <span class="n">add</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/ingredientWidget.json?apiKey=13cc54269ca54d258cf7b07e4383154c&quot;</span>
        <span class="n">add_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
        <span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)]</span> <span class="o">=</span> <span class="n">add_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">])):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">grocery_list_map</span><span class="p">):</span>
                
                <span class="c1"># then add to already existing amount</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                
                <span class="n">add</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">num_recipes</span><span class="p">)</span>
                
                <span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">])</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">num_recipes</span><span class="p">)</span>
                <span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">add</span> <span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">])</span>
    
    
    <span class="n">post_grocery_list</span> <span class="o">=</span> <span class="n">GroceryLists</span><span class="p">(</span><span class="n">weekID</span><span class="p">,</span> <span class="n">userID</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">grocery_list_map</span><span class="p">))</span>
  
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">post_grocery_list</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    
    <span class="c1"># get remaining ingredients</span>
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">restrictions</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    
    <span class="n">includes</span> <span class="o">=</span> <span class="s2">&quot;&amp;includeIngredients=&quot;</span><span class="o">+</span><span class="n">this_user</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="s2">&quot;&amp;excludeIngredients=&quot;</span><span class="o">+</span><span class="n">this_user</span><span class="o">.</span><span class="n">restrictions</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">diet_string</span> <span class="o">=</span><span class="s2">&quot;&amp;diet=&quot;</span>
    <span class="n">diet_types</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gluten_free</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,gluten free&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vegan</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,vegan&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">keto</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,ketogenic&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vegetarian</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,vegetarian&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">paleo</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,paleo&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">pescetarian</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,pescetarian&quot;</span>
        
    <span class="n">diet_string</span><span class="o">+=</span><span class="n">diet_types</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># get recipes IDs from the weekly recipes table</span>
    <span class="n">recipe_ids</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">,</span> <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="p">(</span><span class="n">recipe_ids</span><span class="o">.</span><span class="n">recipeIDs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

    <span class="n">micronutrients</span> <span class="o">=</span> <span class="n">UserNutrition</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>

    <span class="n">energy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>

    <span class="n">vitD</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitD</span><span class="p">)</span>
    <span class="n">vitC</span> <span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitC</span><span class="p">)</span>
    <span class="n">vitA</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitA</span><span class="p">)</span>
    <span class="n">vitE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitE</span><span class="p">)</span>
    <span class="n">calcium</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">calcium</span><span class="p">)</span>
    <span class="n">iron</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">iron</span><span class="p">)</span>
    <span class="n">potassium</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">potassium</span><span class="p">)</span>

    <span class="c1"># ULs</span>
    <span class="n">vitD_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitD_ul</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">vitC_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitC_ul</span><span class="o">-</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">vitA_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitA_ul</span><span class="o">-</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">vitE_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitE_ul</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">calcium_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">calcium_ul</span> <span class="o">-</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">iron_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">iron_ul</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1"># total nutrition (sum) from recipes</span>
    <span class="n">energy_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitD_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitC_sum</span> <span class="o">=</span><span class="mi">0</span>
    <span class="n">vitA_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitE_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">calcium_sum</span> <span class="o">=</span><span class="mi">0</span> 
    <span class="n">iron_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">potassium_sum</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># one json object to hold all the nutrients in all the recipes</span>
    <span class="n">recipe_nutrition_info_json</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># get nutrients of all the recipe IDs</span>
    <span class="k">for</span> <span class="n">recipe</span> <span class="ow">in</span> <span class="n">recipes</span><span class="p">:</span>
        <span class="n">recipe_nutrients_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spoonacular.com/recipes/</span><span class="si">{</span><span class="n">recipe</span><span class="si">}</span><span class="s2">/nutritionWidget.json?apiKey=</span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">recipe_nutrients_url</span><span class="p">)</span>
        <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">]</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="n">energy_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;bad&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">])):</span>
        
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Calcium&quot;</span><span class="p">:</span>
                <span class="n">calcium_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin C&quot;</span><span class="p">:</span>
                <span class="n">vitC_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin A&quot;</span><span class="p">:</span>
                <span class="n">vitA_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin E&quot;</span><span class="p">:</span>
                <span class="n">vitE_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin D&quot;</span><span class="p">:</span>
                <span class="n">vitD_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin D&quot;</span><span class="p">:</span>
                <span class="n">iron_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin D&quot;</span><span class="p">:</span>
                <span class="n">potassium_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        
    <span class="c1"># remaining nutrients</span>
    <span class="n">energy_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">energy_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitD_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitD</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitD_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitC_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitC</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitC_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitA_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitA</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitA_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitE_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitE</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitE_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">calcium_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">calcium</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">calcium_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">iron_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iron</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">iron_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">potassium_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">potassium</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">potassium_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="n">remaining_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy_remaining&quot;</span><span class="p">:</span><span class="n">energy_remaining</span><span class="p">,</span> <span class="s2">&quot;vitD_remaining&quot;</span><span class="p">:</span><span class="n">vitD_remaining</span><span class="p">,</span> <span class="s2">&quot;vitC_remaining&quot;</span><span class="p">:</span><span class="n">vitC_remaining</span><span class="p">,</span> <span class="s2">&quot;vitA_remaining&quot;</span><span class="p">:</span><span class="n">vitA_remaining</span><span class="p">,</span> <span class="s2">&quot;vitE_remaining&quot;</span><span class="p">:</span><span class="n">vitE_remaining</span><span class="p">,</span> <span class="s2">&quot;calcium_remaining&quot;</span><span class="p">:</span><span class="n">calcium_remaining</span><span class="p">,</span> <span class="s2">&quot;iron_remaining&quot;</span><span class="p">:</span><span class="n">iron_remaining</span><span class="p">,</span> <span class="s2">&quot;potassium_remaining&quot;</span><span class="p">:</span><span class="n">potassium_remaining</span><span class="p">}</span>
    
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">remaining_json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">remaining_json</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#return remaining_json</span>
    <span class="c1"># find the largest three nutrients they are missing</span>

    <span class="n">sorted_values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">remaining_json</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">largest_values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">remaining_json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sorted_values</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">largest_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">remaining_nutrients</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="c1"># nutrients to add in url query</span>

    <span class="n">nutrients_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">keys</span><span class="p">()))):</span>

        <span class="k">if</span> <span class="s2">&quot;energy&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minCalories=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxCalories=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;calcium&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minCalcium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxCalcium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;iron&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minIron=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxIron=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;potassium&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minPotassium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">250</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxPotassium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitD&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminD=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminD=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitA&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminA=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">50</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminA=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitC&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminC=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminC=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitE&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminE=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminE=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="c1"># find snacks that fulfill these remaining nutrients</span>

    <span class="n">find_remaining_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/complexSearch&quot;</span>

    <span class="c1"># ingredient preferences are randomized, includes will be added less than 20% of the time due to how much it limits the results</span>
    <span class="n">micros_query_params</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">micros_query_params</span> <span class="o">=</span> <span class="s2">&quot;apiKey=&quot;</span> <span class="o">+</span> <span class="n">api_key</span> <span class="o">+</span> <span class="n">nutrients_query</span> <span class="o">+</span> <span class="n">diet_string</span><span class="o">+</span><span class="n">excludes</span><span class="o">+</span><span class="s2">&quot;&amp;number=30&amp;type=snack,drink,side dish,appetizer,salad,soup,fingerfood&quot;</span>

    <span class="n">micros_query</span> <span class="o">=</span>  <span class="n">find_remaining_url</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">micros_query_params</span> 
    <span class="n">micros_response</span> <span class="o">=</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">micros_query</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">ids_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">micros_response</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">])):</span>
        <span class="n">ids_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">micros_response</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

    <span class="c1"># choose at most two - no user choice</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids_list</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">ids_list</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">ids_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">ids_list_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ids_list</span><span class="p">]</span>

    <span class="n">ids_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ids_list_str</span><span class="p">)</span>
    <span class="n">recipes_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">recipes</span><span class="p">)</span>

    <span class="n">put_string</span> <span class="o">=</span> <span class="n">recipes_string</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">ids_string</span>

    <span class="n">update</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">,</span> <span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span>
    <span class="n">update</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">recipeIDs</span> <span class="o">=</span> <span class="n">put_string</span><span class="p">))</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
    
    <span class="k">return</span> <span class="s2">&quot;recipe &quot;</span> <span class="o">+</span> <span class="n">recipe_string</span> <span class="o">+</span> <span class="s2">&quot; added to &quot;</span> <span class="o">+</span> <span class="n">userID</span></div>

<div class="viewcode-block" id="format_user"><a class="viewcode-back" href="../app.html#app.format_user">[docs]</a><span class="k">def</span> <span class="nf">format_user</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Formats user entity into json&quot;&quot;&quot;</span>
    <span class="k">return</span><span class="p">{</span>
        <span class="s2">&quot;userID&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">userID</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
        <span class="s2">&quot;email&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
        <span class="s2">&quot;gender&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">gender</span><span class="p">,</span>
        <span class="s2">&quot;weight_lbs&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">weight_lbs</span><span class="p">,</span>
        <span class="s2">&quot;age&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">age</span><span class="p">,</span>
        <span class="s2">&quot;height_feet&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">height_feet</span><span class="p">,</span>
        <span class="s2">&quot;height_inches&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">height_inches</span><span class="p">,</span>
        <span class="s2">&quot;activity_level&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">activity_level</span><span class="p">,</span>
        <span class="s2">&quot;vegetarian&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">vegetarian</span><span class="p">,</span>
        <span class="s2">&quot;vegan&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">vegan</span><span class="p">,</span>
        <span class="s2">&quot;gluten_free&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">gluten_free</span><span class="p">,</span>
        <span class="s2">&quot;keto&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">keto</span><span class="p">,</span>
        <span class="s2">&quot;paleo&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">paleo</span><span class="p">,</span>
        <span class="s2">&quot;pescetarian&quot;</span><span class="p">:</span><span class="n">user</span><span class="o">.</span><span class="n">pescetarian</span><span class="p">,</span>
        <span class="s2">&quot;preferences&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">preferences</span><span class="p">,</span>
        <span class="s2">&quot;restrictions&quot;</span><span class="p">:</span> <span class="n">user</span><span class="o">.</span><span class="n">restrictions</span>
    <span class="p">}</span></div>

<span class="c1"># POST user information</span>

<span class="c1"># POST ALL</span>
<div class="viewcode-block" id="post_whole_user"><a class="viewcode-back" href="../app.html#app.post_whole_user">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post_whole_user&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">post_whole_user</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function is used to post user account information and user nutrition information into a local database if the front-end is not yet developed.</span>

<span class="sd">    Returns:</span>
<span class="sd">        JSON: a JSON object of the user information that was posted when this function was run.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="n">email</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;email&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
    <span class="n">gender</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;gender&#39;</span><span class="p">]</span>
    <span class="n">weight_lbs</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;weight_lbs&#39;</span><span class="p">]</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">]</span>
    <span class="n">height_feet</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;height_feet&#39;</span><span class="p">]</span>
    <span class="n">height_inches</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;height_inches&#39;</span><span class="p">]</span>
    <span class="n">activity_level</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;activity_level&#39;</span><span class="p">]</span>
    <span class="n">vegetarian</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;vegetarian&#39;</span><span class="p">]</span>
    <span class="n">vegan</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;vegan&#39;</span><span class="p">]</span>
    <span class="n">gluten_free</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;gluten_free&#39;</span><span class="p">]</span>
    <span class="n">keto</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;keto&#39;</span><span class="p">]</span>
    <span class="n">paleo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;paleo&#39;</span><span class="p">]</span>
    <span class="n">pescetarian</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;pescetarian&#39;</span><span class="p">]</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;preferences&#39;</span><span class="p">]</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">json</span><span class="p">[</span><span class="s1">&#39;restrictions&#39;</span><span class="p">]</span>

    <span class="n">thisUser</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">email</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">gender</span><span class="p">,</span> <span class="n">weight_lbs</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">height_feet</span><span class="p">,</span>
                    <span class="n">height_inches</span><span class="p">,</span> <span class="n">activity_level</span><span class="p">,</span> <span class="n">vegetarian</span><span class="p">,</span> <span class="n">vegan</span><span class="p">,</span> <span class="n">gluten_free</span><span class="p">,</span> <span class="n">keto</span><span class="p">,</span> <span class="n">paleo</span><span class="p">,</span> <span class="n">pescetarian</span><span class="p">,</span> <span class="n">preferences</span><span class="p">,</span> <span class="n">restrictions</span><span class="p">)</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">thisUser</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="c1"># post user nutrition </span>
    <span class="n">energy</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">carbs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ree</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">calcium</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iron</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">potassium</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">vitD</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitC</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitA</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitE</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">getuser</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">email</span><span class="o">=</span><span class="n">email</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">userID</span> <span class="o">=</span> <span class="n">getuser</span><span class="o">.</span><span class="n">userID</span>
    
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="c1">#print(this_user.username)</span>
    <span class="c1">#return this_user.username</span>
    
    <span class="c1"># returns an array in the format: [kcals, protein, fat, carbs, ...]</span>
    
    <span class="c1"># protein</span>
    <span class="c1"># fats</span>
    <span class="c1"># carbohydrates</span>
    <span class="c1"># vitamins</span>
    <span class="c1"># minerals</span>

    <span class="n">weight_kg</span> <span class="o">=</span> <span class="n">this_user</span><span class="o">.</span><span class="n">weight_lbs</span><span class="o">/</span><span class="mf">2.20462262185</span>
    <span class="n">height_cm</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">height_feet</span> <span class="o">+</span> <span class="n">this_user</span><span class="o">.</span><span class="n">height_inches</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mf">30.48</span>
    
    <span class="c1"># MACROS</span>
    <span class="c1"># ree: resting energy expenditure</span>
    <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;male&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Male&#39;</span><span class="p">):</span>
        <span class="n">ree</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">weight_kg</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">6.25</span><span class="o">*</span><span class="n">height_cm</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span> <span class="o">==</span> <span class="s1">&#39;female&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Female&#39;</span><span class="p">):</span>
        <span class="n">ree</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">weight_kg</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">6.25</span><span class="o">*</span><span class="n">height_cm</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="p">)</span> <span class="o">-</span> <span class="mi">161</span>
    <span class="c1">#return [ree]</span>
    <span class="c1"># energy with activity level</span>
    <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;sedentary&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;Sedentary&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.2</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;Low&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.375</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;medium&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;Medium&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.55</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HEREE&quot;</span><span class="p">)</span>
        <span class="c1">#energy = ree*1.375</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;High&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.725</span>
    
    <span class="c1">#return [energy]</span>
    <span class="c1"># protein</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="n">this_user</span><span class="o">.</span><span class="n">weight_lbs</span> <span class="o">*</span> <span class="mf">0.825</span>
    
    <span class="c1"># fats</span>
    <span class="n">fat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">energy</span><span class="p">)</span><span class="o">/</span><span class="mi">9</span>
    
    <span class="c1"># carbs</span>
    <span class="n">carbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">energy</span> <span class="o">-</span> <span class="p">(</span><span class="n">protein</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">fat</span><span class="o">*</span><span class="mi">9</span><span class="p">))</span><span class="o">/</span><span class="mi">4</span>
    
    <span class="c1"># MICROS</span>
    
    <span class="c1"># in the format of: [energy, vitD(micrograms/d), vitC(micrograms/d), vitA(micrograms/d), vitE(mg/d), calcium (mg/d), iron(mg/d), potassium (mg/d)]</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">vitC</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">vitA</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">vitE</span> <span class="o">=</span> <span class="mi">6</span>
        
        <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">63</span>
        <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">200</span>
            
        <span class="n">calcium</span> <span class="o">=</span> <span class="mi">700</span>
        <span class="n">iron</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2000</span>
        
        <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
        <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="c1"># NO potassium_ul</span>
        
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">vitC</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="n">vitA</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="n">vitE</span> <span class="o">=</span> <span class="mi">7</span>
        
        <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">75</span>
        <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">650</span>
        <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">900</span>
        <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">300</span>
        
        <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">iron</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">potassium</span> <span class="o">=</span><span class="mi">2300</span>
        
        <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
        <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="c1"># NO potassium_ul</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;male&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Male&#39;</span><span class="p">):</span>
            <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="n">vitC</span> <span class="o">=</span> <span class="mi">90</span>
            <span class="n">vitA</span> <span class="o">=</span> <span class="mi">900</span>
            <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
            
            <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">8</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">13</span><span class="p">):</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">45</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">600</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">11</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">1700</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">600</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">2500</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">13</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">18</span><span class="p">):</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">75</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1800</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">2800</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">800</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">11</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">3000</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">30</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">30</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">50</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">50</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">20</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1200</span> 
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
            
            
        <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;female&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Female&#39;</span><span class="p">):</span>
            
            <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">8</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">13</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">45</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">600</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">11</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">1700</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">600</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2300</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
    
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">13</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">18</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1800</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">2800</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">800</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2300</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">30</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">18</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">30</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">50</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">18</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">50</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
    
    <span class="n">return_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">energy</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span> <span class="n">fat</span><span class="p">,</span> <span class="n">carbs</span><span class="p">,</span> <span class="n">vitD</span><span class="p">,</span> <span class="n">vitC</span><span class="p">,</span> <span class="n">vitA</span><span class="p">,</span> <span class="n">vitE</span><span class="p">,</span> <span class="n">calcium</span><span class="p">,</span> <span class="n">iron</span><span class="p">,</span> <span class="n">potassium</span><span class="p">,</span> <span class="n">vitD_ul</span><span class="p">,</span> <span class="n">vitC_ul</span><span class="p">,</span> <span class="n">vitA_ul</span><span class="p">,</span> <span class="n">vitE_ul</span><span class="p">,</span> <span class="n">calcium_ul</span><span class="p">,</span> <span class="n">iron_ul</span><span class="p">]</span>
    <span class="c1">#print(type(protein))</span>
     
    <span class="n">nutrition_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s2">&quot;protein&quot;</span><span class="p">:</span><span class="n">protein</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">:</span> <span class="n">fat</span><span class="p">,</span> <span class="s2">&quot;carbs&quot;</span><span class="p">:</span> <span class="n">carbs</span><span class="p">,</span> <span class="s2">&quot;vitD&quot;</span><span class="p">:</span> <span class="n">vitD</span><span class="p">,</span> <span class="s2">&quot;vitC&quot;</span><span class="p">:</span> <span class="n">vitC</span><span class="p">,</span> <span class="s2">&quot;vitA&quot;</span><span class="p">:</span> <span class="n">vitA</span><span class="p">,</span> <span class="s2">&quot;vitE&quot;</span><span class="p">:</span> <span class="n">vitE</span><span class="p">,</span> <span class="s2">&quot;calcium&quot;</span><span class="p">:</span> <span class="n">calcium</span><span class="p">,</span> <span class="s2">&quot;iron&quot;</span><span class="p">:</span> <span class="n">iron</span><span class="p">,</span> <span class="s2">&quot;potassium&quot;</span><span class="p">:</span> <span class="n">potassium</span><span class="p">,</span> <span class="s2">&quot;vitD_ul&quot;</span><span class="p">:</span><span class="n">vitD_ul</span><span class="p">,</span> <span class="s2">&quot;vitC_ul&quot;</span><span class="p">:</span><span class="n">vitC_ul</span><span class="p">,</span> <span class="s2">&quot;vitA_ul&quot;</span><span class="p">:</span><span class="n">vitA_ul</span><span class="p">,</span> <span class="s2">&quot;vitE_ul&quot;</span><span class="p">:</span><span class="n">vitE_ul</span><span class="p">,</span> <span class="s2">&quot;calcium_ul&quot;</span><span class="p">:</span><span class="n">calcium_ul</span><span class="p">,</span> <span class="s2">&quot;iron_ul&quot;</span><span class="p">:</span><span class="n">iron_ul</span><span class="p">}</span>

    <span class="c1"># post information to nutrition table in db</span>
    <span class="n">user_nutrition</span> <span class="o">=</span> <span class="n">UserNutrition</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span> <span class="n">fat</span><span class="p">,</span> <span class="n">carbs</span><span class="p">,</span> <span class="n">calcium</span><span class="p">,</span> <span class="n">iron</span><span class="p">,</span> <span class="n">potassium</span><span class="p">,</span> <span class="n">calcium_ul</span><span class="p">,</span> <span class="n">iron_ul</span><span class="p">,</span> <span class="n">vitA</span><span class="p">,</span> <span class="n">vitD</span><span class="p">,</span><span class="n">vitC</span><span class="p">,</span><span class="n">vitE</span><span class="p">,</span> <span class="n">vitA_ul</span><span class="p">,</span> <span class="n">vitD_ul</span><span class="p">,</span><span class="n">vitC_ul</span><span class="p">,</span><span class="n">vitE_ul</span><span class="p">)</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user_nutrition</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">format_user</span><span class="p">(</span><span class="n">thisUser</span><span class="p">)</span></div>

<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">{</span>
<span class="sd">    &quot;username&quot; :&quot;mahirah&quot;,</span>
<span class="sd">    &quot;email&quot; :&quot;mahirah@gmail.com&quot;,</span>
<span class="sd">    &quot;password&quot; :&quot;examplepass&quot;,</span>
<span class="sd">    &quot;gender&quot;: &quot;female&quot;,</span>
<span class="sd">    &quot;weight_lbs&quot; : 126,</span>
<span class="sd">    &quot;age&quot; : 30,</span>
<span class="sd">    &quot;height_feet&quot; :5,</span>
<span class="sd">    &quot;height_inches&quot; :5,</span>
<span class="sd">    &quot;activity_level&quot;:&quot;low&quot;,</span>
<span class="sd">    &quot;vegetarian&quot; : false,</span>
<span class="sd">    &quot;vegan&quot; : false,</span>
<span class="sd">    &quot;gluten_free&quot; : true,</span>
<span class="sd">    &quot;keto&quot; : false,</span>
<span class="sd">    &quot;paleo&quot; : false,</span>
<span class="sd">    &quot;pescetarian&quot;: true,</span>
<span class="sd">    &quot;preferences&quot; :&quot;chicken, brocolli&quot;,</span>
<span class="sd">    &quot;restrictions&quot; :&quot;none&quot;</span>
<span class="sd">}</span>
<span class="sd">&#39;&#39;&#39;</span>



<span class="c1"># Checks for user and password match, returns user if exist</span>
<div class="viewcode-block" id="check_login"><a class="viewcode-back" href="../app.html#app.check_login">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/checklogin&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">check_login</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks for user and password match, returns user if exist&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pss</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">pss</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_user</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="c1"># formatted_user = format_user(result)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">users</span><span class="p">}</span></div>

<span class="c1"># Creates account if username is unique</span>
<div class="viewcode-block" id="create_user"><a class="viewcode-back" href="../app.html#app.create_user">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/createuser&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">create_user</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates account if username is unique&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">pss</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pass&#39;</span><span class="p">)</span>
    <span class="n">eml</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;email&#39;</span><span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_user</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>

    <span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">users</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">newUser</span> <span class="o">=</span> <span class="n">User</span><span class="p">(</span><span class="n">username</span><span class="o">=</span> <span class="n">user</span><span class="p">,</span>
                       <span class="n">password</span><span class="o">=</span> <span class="n">pss</span><span class="p">,</span>
                       <span class="n">email</span><span class="o">=</span> <span class="n">eml</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">newUser</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">users</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">users</span><span class="p">}</span></div>
    
<div class="viewcode-block" id="get_user_id"><a class="viewcode-back" href="../app.html#app.get_user_id">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_user_id/&lt;username&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_user_id</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;returns user id from username&quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">userID</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span></div>
    
<span class="c1"># Returns requsted user from username</span>
<div class="viewcode-block" id="get_user_info"><a class="viewcode-back" href="../app.html#app.get_user_info">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/getuserinfo&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_user_info</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Returns user in json from username&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    <span class="n">users</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">user</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
        <span class="n">users</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">format_user</span><span class="p">(</span><span class="n">user</span><span class="p">))</span>
    <span class="c1"># formatted_user = format_user(result)</span>
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">users</span><span class="p">}</span></div>
    
<span class="c1"># Updates user</span>
<div class="viewcode-block" id="update_user"><a class="viewcode-back" href="../app.html#app.update_user">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/updateuser&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">update_user</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Updates all user info&quot;&quot;&quot;</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user&#39;</span><span class="p">)</span>
    <span class="n">gender</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gender&#39;</span><span class="p">)</span>
    <span class="n">weight_lbs</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;weight_lbs&#39;</span><span class="p">)</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;age&#39;</span><span class="p">)</span>
    <span class="n">height_feet</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height_feet&#39;</span><span class="p">)</span>
    <span class="n">height_inches</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;height_inches&#39;</span><span class="p">)</span>
    <span class="n">activity_level</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;activity_level&#39;</span><span class="p">)</span>
    <span class="n">vegetarian</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vegetarian&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">vegan</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;vegan&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">gluten_free</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;gluten_free&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">keto</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;keto&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">paleo</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;paleo&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">pescetarian</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;pescetarian&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;preferences&#39;</span><span class="p">)</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;restrictions&#39;</span><span class="p">)</span>

    
    <span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">user</span><span class="p">)</span>
    
    <span class="n">user</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span>
                    <span class="n">gender</span> <span class="o">=</span> <span class="n">gender</span><span class="p">,</span> 
                    <span class="n">weight_lbs</span> <span class="o">=</span> <span class="n">weight_lbs</span><span class="p">,</span>
                    <span class="n">age</span> <span class="o">=</span> <span class="n">age</span><span class="p">,</span>
                    <span class="n">height_feet</span> <span class="o">=</span> <span class="n">height_feet</span><span class="p">,</span>
                    <span class="n">height_inches</span> <span class="o">=</span> <span class="n">height_inches</span><span class="p">,</span> 
                    <span class="n">activity_level</span> <span class="o">=</span> <span class="n">activity_level</span><span class="p">,</span> 
                    <span class="n">vegetarian</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">vegetarian</span><span class="p">),</span> 
                    <span class="n">vegan</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">vegan</span><span class="p">),</span>
                    <span class="n">gluten_free</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">gluten_free</span><span class="p">),</span> 
                    <span class="n">keto</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">keto</span><span class="p">),</span> 
                    <span class="n">paleo</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">paleo</span><span class="p">),</span> 
                    <span class="n">pescetarian</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">pescetarian</span><span class="p">),</span>
                    <span class="n">preferences</span> <span class="o">=</span> <span class="n">preferences</span><span class="p">,</span> 
                    <span class="n">restrictions</span> <span class="o">=</span> <span class="n">restrictions</span>
                    <span class="p">))</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    u = str(user.one()).split(&#39; &#39;)[1]</span>

<span class="sd">    user = User.query.filter_by(username=u)</span>
<span class="sd">    return(str(user.userID))</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    # post user nutrition </span>
<span class="sd">    energy = 0</span>
<span class="sd">    protein = 0</span>
<span class="sd">    fat = 0</span>
<span class="sd">    carbs = 0</span>
<span class="sd">    ree = 0</span>

<span class="sd">    calcium = 0</span>
<span class="sd">    iron = 0</span>
<span class="sd">    potassium = 0</span>
<span class="sd">    </span>
<span class="sd">    calcium_ul = 0</span>
<span class="sd">    iron_ul = 0</span>

<span class="sd">    vitD = 0</span>
<span class="sd">    vitC = 0</span>
<span class="sd">    vitA = 0</span>
<span class="sd">    vitE = 0</span>
<span class="sd">    </span>
<span class="sd">    vitD_ul = 0</span>
<span class="sd">    vitC_ul = 0</span>
<span class="sd">    vitA_ul = 0</span>
<span class="sd">    vitE_ul = 0</span>

<span class="sd">    #print(&quot;username: &quot;, user)</span>
<span class="sd">    #getuser = User.query.filter_by(username=user).one()</span>
<span class="sd">    </span>
<span class="sd">    #userID = getuser.userID</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    #this_user = User.query.filter_by(userID = userID).one()</span>
<span class="sd">    #print(this_user.username)</span>
<span class="sd">    #return this_user.username</span>
<span class="sd">    </span>
<span class="sd">    # returns an array in the format: [kcals, protein, fat, carbs, ...]</span>
<span class="sd">    </span>
<span class="sd">    # protein</span>
<span class="sd">    # fats</span>
<span class="sd">    # carbohydrates</span>
<span class="sd">    # vitamins</span>
<span class="sd">    # minerals</span>

<span class="sd">    weight_kg =float(weight_lbs)/2.20462262185</span>
<span class="sd">    height_cm = (float(height_feet) + float(height_inches)/12) * 30.48</span>
<span class="sd">    </span>
<span class="sd">    # MACROS</span>
<span class="sd">    # ree: resting energy expenditure</span>
<span class="sd">    if(gender==&#39;male&#39;):</span>
<span class="sd">        ree = (10*float(weight_kg)) + (6.25*float(height_cm)) - (5 * float(age)) + 5</span>
<span class="sd">    elif(gender == &#39;female&#39;):</span>
<span class="sd">        ree = (10*float(weight_kg)) + (6.25*float(height_cm)) - (5 * float(age)) - 161</span>
<span class="sd">    #return [ree]</span>
<span class="sd">    # energy with activity level</span>
<span class="sd">    if(activity_level == &#39;sedentary&#39;):</span>
<span class="sd">        energy = ree*1.2</span>
<span class="sd">    elif(activity_level == &#39;low&#39;):</span>
<span class="sd">        energy = ree*1.375</span>
<span class="sd">    elif(activity_level == &#39;medium&#39;):</span>
<span class="sd">        energy = ree*1.55</span>
<span class="sd">    elif(activity_level == &#39;high&#39;):</span>
<span class="sd">        energy = ree*1.725</span>
<span class="sd">    </span>
<span class="sd">    #return [energy]</span>
<span class="sd">    # protein</span>
<span class="sd">    protein =float(weight_lbs) * 0.825</span>
<span class="sd">    </span>
<span class="sd">    # fats</span>
<span class="sd">    fat = (0.3*float(energy))/9</span>
<span class="sd">    </span>
<span class="sd">    # carbs</span>
<span class="sd">    carbs = (float(energy) - (protein*4) - (fat*9))/4</span>
<span class="sd">    </span>
<span class="sd">    # MICROS</span>
<span class="sd">    </span>
<span class="sd">    # in the format of: [energy, vitD(micrograms/d), vitC(micrograms/d), vitA(micrograms/d), vitE(mg/d), calcium (mg/d), iron(mg/d), potassium (mg/d)]</span>
<span class="sd">    </span>
<span class="sd">    if(float(age)&gt;=1 and float(age)&lt;=3):</span>
<span class="sd">        vitD = 15</span>
<span class="sd">        vitC = 15</span>
<span class="sd">        vitA = 300</span>
<span class="sd">        vitE = 6</span>
<span class="sd">        </span>
<span class="sd">        vitD_ul = 63</span>
<span class="sd">        vitC_ul = 400</span>
<span class="sd">        vitA_ul = 600</span>
<span class="sd">        vitE_ul = 200</span>
<span class="sd">            </span>
<span class="sd">        calcium = 700</span>
<span class="sd">        iron = 7</span>
<span class="sd">        potassium = 2000</span>
<span class="sd">        </span>
<span class="sd">        calcium_ul = 2500</span>
<span class="sd">        iron_ul = 40</span>
<span class="sd">        # NO potassium_ul</span>
<span class="sd">        </span>
<span class="sd">    elif(float(age)&gt;3 and float(age)&lt;=8):</span>
<span class="sd">        vitD = 15</span>
<span class="sd">        vitC = 25</span>
<span class="sd">        vitA = 400</span>
<span class="sd">        vitE = 7</span>
<span class="sd">        </span>
<span class="sd">        vitD_ul = 75</span>
<span class="sd">        vitC_ul = 650</span>
<span class="sd">        vitA_ul = 900</span>
<span class="sd">        vitE_ul = 300</span>
<span class="sd">        </span>
<span class="sd">        calcium = 1000</span>
<span class="sd">        iron = 10</span>
<span class="sd">        potassium =2300</span>
<span class="sd">        </span>
<span class="sd">        calcium_ul = 2500</span>
<span class="sd">        iron_ul = 40</span>
<span class="sd">        # NO potassium_ul</span>
<span class="sd">        </span>
<span class="sd">    else:</span>
<span class="sd">        if(gender==&#39;male&#39;):</span>
<span class="sd">            vitD = 15</span>
<span class="sd">            vitC = 90</span>
<span class="sd">            vitA = 900</span>
<span class="sd">            vitE = 15</span>
<span class="sd">            </span>
<span class="sd">            if(float(age)&gt;8 and float(age)&lt;=13):</span>
<span class="sd">                vitC = 45</span>
<span class="sd">                vitA = 600</span>
<span class="sd">                vitE = 11</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 1200</span>
<span class="sd">                vitA_ul = 1700</span>
<span class="sd">                vitE_ul = 600</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1300</span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium =2500</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 3000</span>
<span class="sd">                iron_ul = 40</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;13 and float(age) &lt;=18):</span>
<span class="sd">                vitC = 75</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 1800</span>
<span class="sd">                vitA_ul = 2800</span>
<span class="sd">                vitE_ul = 800</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1300</span>
<span class="sd">                iron = 11</span>
<span class="sd">                potassium = 3000</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 3000</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;18 and float(age) &lt;=30):</span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1000</span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium = 3400</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2500</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;30 and float(age) &lt;=50):</span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1000</span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium =3400</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2500</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;50 and float(age) &lt;=70):</span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1000</span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium =3400</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2000</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;70):</span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                vitD = 20</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1200 </span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium =3400</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2000</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">            </span>
<span class="sd">            </span>
<span class="sd">        elif(gender==&#39;female&#39;):</span>
<span class="sd">            </span>
<span class="sd">            if(float(age)&gt;8 and float(age)&lt;=13):</span>
<span class="sd">                vitD = 15</span>
<span class="sd">                vitC = 45</span>
<span class="sd">                vitA = 600</span>
<span class="sd">                vitE = 11</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 1200</span>
<span class="sd">                vitA_ul = 1700</span>
<span class="sd">                vitE_ul = 600</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1300</span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium = 2300</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 3000</span>
<span class="sd">                iron_ul = 40</span>
<span class="sd">    </span>
<span class="sd">            elif(float(age)&gt;13 and float(age) &lt;=18):</span>
<span class="sd">                vitD = 15</span>
<span class="sd">                vitC = 65</span>
<span class="sd">                vitA = 700</span>
<span class="sd">                vitE = 15</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 1800</span>
<span class="sd">                vitA_ul = 2800</span>
<span class="sd">                vitE_ul = 800</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1300</span>
<span class="sd">                iron = 15</span>
<span class="sd">                potassium = 2300</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 3000</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;18 and float(age) &lt;=30):</span>
<span class="sd">                vitD = 15</span>
<span class="sd">                vitC = 65</span>
<span class="sd">                vitA = 700</span>
<span class="sd">                vitE = 15</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1000</span>
<span class="sd">                iron = 18</span>
<span class="sd">                potassium = 2600</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2500</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;30 and float(age) &lt;=50):</span>
<span class="sd">                vitD = 15</span>
<span class="sd">                vitC = 65</span>
<span class="sd">                vitA = 700</span>
<span class="sd">                vitE = 15</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1000</span>
<span class="sd">                iron = 18</span>
<span class="sd">                potassium = 2600</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2500</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;50 and float(age) &lt;=70):</span>
<span class="sd">                vitD = 15</span>
<span class="sd">                vitC = 65</span>
<span class="sd">                vitA = 700</span>
<span class="sd">                vitE = 15</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1200</span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium = 2600</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2000</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">                </span>
<span class="sd">            elif(float(age)&gt;70):</span>
<span class="sd">                vitD = 20</span>
<span class="sd">                vitC = 65</span>
<span class="sd">                vitA = 700</span>
<span class="sd">                vitE = 15</span>
<span class="sd">                </span>
<span class="sd">                vitD_ul = 100</span>
<span class="sd">                vitC_ul = 2000</span>
<span class="sd">                vitA_ul = 3000</span>
<span class="sd">                vitE_ul = 1000</span>
<span class="sd">                </span>
<span class="sd">                calcium = 1200</span>
<span class="sd">                iron = 8</span>
<span class="sd">                potassium = 2600</span>
<span class="sd">                </span>
<span class="sd">                calcium_ul = 2000</span>
<span class="sd">                iron_ul = 45</span>
<span class="sd">    </span>
<span class="sd">    return_list = [energy, protein, fat, carbs, vitD, vitC, vitA, vitE, calcium, iron, potassium, vitD_ul, vitC_ul, vitA_ul, vitE_ul, calcium_ul, iron_ul]</span>
<span class="sd">    #print(type(protein))</span>
<span class="sd">     </span>
<span class="sd">    nutrition_info = {&quot;energy&quot;:energy, &quot;protein&quot;:protein, &quot;fat&quot;: fat, &quot;carbs&quot;: carbs, &quot;vitD&quot;: vitD, &quot;vitC&quot;: vitC, &quot;vitA&quot;: vitA, &quot;vitE&quot;: vitE, &quot;calcium&quot;: calcium, &quot;iron&quot;: iron, &quot;potassium&quot;: potassium, &quot;vitD_ul&quot;:vitD_ul, &quot;vitC_ul&quot;:vitC_ul, &quot;vitA_ul&quot;:vitA_ul, &quot;vitE_ul&quot;:vitE_ul, &quot;calcium_ul&quot;:calcium_ul, &quot;iron_ul&quot;:iron_ul}</span>

<span class="sd">    # post information to nutrition table in db</span>
<span class="sd">    user_nutrition = UserNutrition(user.userID, energy, protein, fat, carbs, calcium, iron, potassium, calcium_ul, iron_ul, vitA, vitD,vitC,vitE, vitA_ul, vitD_ul,vitC_ul,vitE_ul)</span>
<span class="sd">    </span>
<span class="sd">    db.session.add(user_nutrition)</span>
<span class="sd">    db.session.commit()</span>
<span class="sd">    &#39;&#39;&#39;</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;user&#39;</span><span class="p">:</span> <span class="n">format_user</span><span class="p">(</span><span class="n">user</span><span class="o">.</span><span class="n">one</span><span class="p">())}</span></div>

<div class="viewcode-block" id="update_link"><a class="viewcode-back" href="../app.html#app.update_link">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/updatelink&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;PUT&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">update_link</span><span class="p">():</span>
    <span class="k">return</span> <span class="mi">1</span></div>


<div class="viewcode-block" id="get_nutrition"><a class="viewcode-back" href="../app.html#app.get_nutrition">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_nutrition/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_nutrition</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve nutrition information for a given user.</span>

<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A dictionary of strings containing nutrition information for the specified user.</span>
<span class="sd">    :rtype: String dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">UserNutrition</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">nutrition_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="s2">&quot;protein&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">fat</span><span class="p">,</span> <span class="s2">&quot;carbs&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">carbs</span><span class="p">,</span> <span class="s2">&quot;vitD&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitD</span><span class="p">,</span> <span class="s2">&quot;vitC&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitC</span><span class="p">,</span> <span class="s2">&quot;vitA&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitA</span><span class="p">,</span> <span class="s2">&quot;vitE&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitE</span><span class="p">,</span> <span class="s2">&quot;calcium&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">calcium</span><span class="p">,</span> <span class="s2">&quot;iron&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">iron</span><span class="p">,</span> <span class="s2">&quot;potassium&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">potassium</span><span class="p">,</span> <span class="s2">&quot;vitD_ul&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">vitD_ul</span><span class="p">,</span> <span class="s2">&quot;vitC_ul&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">vitC_ul</span><span class="p">,</span> <span class="s2">&quot;vitA_ul&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">vitA_ul</span><span class="p">,</span> <span class="s2">&quot;vitE_ul&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">vitE_ul</span><span class="p">,</span> <span class="s2">&quot;calcium_ul&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">calcium_ul</span><span class="p">,</span> <span class="s2">&quot;iron_ul&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">iron_ul</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">nutrition_info</span> </div>

<div class="viewcode-block" id="post_nutrition"><a class="viewcode-back" href="../app.html#app.post_nutrition">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post_nutrition/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">post_nutrition</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Add nutrition information for a given user to the database.</span>

<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A string indicating that the user&#39;s nutrition information was successfully added to the database.</span>
<span class="sd">    :rtype: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">protein</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fat</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">carbs</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ree</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">calcium</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iron</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">potassium</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">vitD</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitC</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitA</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitE</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="c1">#print(this_user.username)</span>
    <span class="c1">#return this_user.username</span>
    
    <span class="c1"># returns an array in the format: [kcals, protein, fat, carbs, ...]</span>
    
    <span class="c1"># protein</span>
    <span class="c1"># fats</span>
    <span class="c1"># carbohydrates</span>
    <span class="c1"># vitamins</span>
    <span class="c1"># minerals</span>

    <span class="n">weight_kg</span> <span class="o">=</span> <span class="n">this_user</span><span class="o">.</span><span class="n">weight_lbs</span><span class="o">/</span><span class="mf">2.20462262185</span>
    <span class="n">height_cm</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">height_feet</span> <span class="o">+</span> <span class="n">this_user</span><span class="o">.</span><span class="n">height_inches</span><span class="o">/</span><span class="mi">12</span><span class="p">)</span> <span class="o">*</span> <span class="mf">30.48</span>
    
    <span class="c1"># MACROS</span>
    <span class="c1"># ree: resting energy expenditure</span>
    <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;male&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Male&#39;</span><span class="p">):</span>
        <span class="n">ree</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">weight_kg</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">6.25</span><span class="o">*</span><span class="n">height_cm</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span> <span class="o">==</span> <span class="s1">&#39;female&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Female&#39;</span><span class="p">):</span>
        <span class="n">ree</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="n">weight_kg</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mf">6.25</span><span class="o">*</span><span class="n">height_cm</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="p">)</span> <span class="o">-</span> <span class="mi">161</span>
    <span class="c1">#return [ree]</span>
    <span class="c1"># energy with activity level</span>
    <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;sedentary&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.2</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;low&#39;</span><span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;Low&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.375</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;medium&#39;</span><span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;Medium&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.55</span>
        <span class="c1">#energy = ree*1.375</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;HEREE 2&quot;</span><span class="p">)</span>
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;high&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">activity_level</span> <span class="o">==</span> <span class="s1">&#39;High&#39;</span><span class="p">):</span>
        <span class="n">energy</span> <span class="o">=</span> <span class="n">ree</span><span class="o">*</span><span class="mf">1.725</span>
    
    <span class="c1">#return [energy]</span>
    <span class="c1"># protein</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="n">this_user</span><span class="o">.</span><span class="n">weight_lbs</span> <span class="o">*</span> <span class="mf">0.825</span>
    
    <span class="c1"># fats</span>
    <span class="n">fat</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.3</span><span class="o">*</span><span class="n">energy</span><span class="p">)</span><span class="o">/</span><span class="mi">9</span>
    
    <span class="c1"># carbs</span>
    <span class="n">carbs</span> <span class="o">=</span> <span class="p">(</span><span class="n">energy</span> <span class="o">-</span> <span class="p">(</span><span class="n">protein</span><span class="o">*</span><span class="mi">4</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">fat</span><span class="o">*</span><span class="mi">9</span><span class="p">))</span><span class="o">/</span><span class="mi">4</span>
    
    <span class="c1"># MICROS</span>
    
    <span class="c1"># in the format of: [energy, vitD(micrograms/d), vitC(micrograms/d), vitA(micrograms/d), vitE(mg/d), calcium (mg/d), iron(mg/d), potassium (mg/d)]</span>
    
    <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;=</span><span class="mi">1</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">3</span><span class="p">):</span>
        <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">vitC</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">vitA</span> <span class="o">=</span> <span class="mi">300</span>
        <span class="n">vitE</span> <span class="o">=</span> <span class="mi">6</span>
        
        <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">63</span>
        <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">600</span>
        <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">200</span>
            
        <span class="n">calcium</span> <span class="o">=</span> <span class="mi">700</span>
        <span class="n">iron</span> <span class="o">=</span> <span class="mi">7</span>
        <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2000</span>
        
        <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
        <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="c1"># NO potassium_ul</span>
        
    <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">8</span><span class="p">):</span>
        <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
        <span class="n">vitC</span> <span class="o">=</span> <span class="mi">25</span>
        <span class="n">vitA</span> <span class="o">=</span> <span class="mi">400</span>
        <span class="n">vitE</span> <span class="o">=</span> <span class="mi">7</span>
        
        <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">75</span>
        <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">650</span>
        <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">900</span>
        <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">300</span>
        
        <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">iron</span> <span class="o">=</span> <span class="mi">10</span>
        <span class="n">potassium</span> <span class="o">=</span><span class="mi">2300</span>
        
        <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
        <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
        <span class="c1"># NO potassium_ul</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;male&#39;</span><span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Male&#39;</span><span class="p">):</span>
            <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
            <span class="n">vitC</span> <span class="o">=</span> <span class="mi">90</span>
            <span class="n">vitA</span> <span class="o">=</span> <span class="mi">900</span>
            <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
            
            <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">8</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">13</span><span class="p">):</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">45</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">600</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">11</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">1700</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">600</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">2500</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">13</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">18</span><span class="p">):</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">75</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1800</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">2800</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">800</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">11</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">3000</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">30</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">30</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">50</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">50</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">20</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1200</span> 
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span><span class="mi">3400</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
            
            
        <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;female&#39;</span> <span class="ow">or</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gender</span><span class="o">==</span><span class="s1">&#39;Female&#39;</span><span class="p">):</span>
            
            <span class="k">if</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">8</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&lt;=</span><span class="mi">13</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">45</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">600</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">11</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">1700</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">600</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2300</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">40</span>
    
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">13</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">18</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">1800</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">2800</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">800</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1300</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2300</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">18</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">30</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">18</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">30</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">50</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1000</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">18</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2500</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">50</span> <span class="ow">and</span> <span class="n">this_user</span><span class="o">.</span><span class="n">age</span> <span class="o">&lt;=</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">15</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
                
            <span class="k">elif</span><span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">age</span><span class="o">&gt;</span><span class="mi">70</span><span class="p">):</span>
                <span class="n">vitD</span> <span class="o">=</span> <span class="mi">20</span>
                <span class="n">vitC</span> <span class="o">=</span> <span class="mi">65</span>
                <span class="n">vitA</span> <span class="o">=</span> <span class="mi">700</span>
                <span class="n">vitE</span> <span class="o">=</span> <span class="mi">15</span>
                
                <span class="n">vitD_ul</span> <span class="o">=</span> <span class="mi">100</span>
                <span class="n">vitC_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">vitA_ul</span> <span class="o">=</span> <span class="mi">3000</span>
                <span class="n">vitE_ul</span> <span class="o">=</span> <span class="mi">1000</span>
                
                <span class="n">calcium</span> <span class="o">=</span> <span class="mi">1200</span>
                <span class="n">iron</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">potassium</span> <span class="o">=</span> <span class="mi">2600</span>
                
                <span class="n">calcium_ul</span> <span class="o">=</span> <span class="mi">2000</span>
                <span class="n">iron_ul</span> <span class="o">=</span> <span class="mi">45</span>
    
    <span class="c1">#return_list = [energy, protein, fat, carbs, vitD, vitC, vitA, vitE, calcium, iron, potassium, vitD_ul, vitC_ul, vitA_ul, vitE_ul, calcium_ul, iron_ul]</span>
    <span class="c1">#print(type(protein))</span>
     
    <span class="n">nutrition_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span><span class="n">energy</span><span class="p">,</span> <span class="s2">&quot;protein&quot;</span><span class="p">:</span><span class="n">protein</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">:</span> <span class="n">fat</span><span class="p">,</span> <span class="s2">&quot;carbs&quot;</span><span class="p">:</span> <span class="n">carbs</span><span class="p">,</span> <span class="s2">&quot;vitD&quot;</span><span class="p">:</span> <span class="n">vitD</span><span class="p">,</span> <span class="s2">&quot;vitC&quot;</span><span class="p">:</span> <span class="n">vitC</span><span class="p">,</span> <span class="s2">&quot;vitA&quot;</span><span class="p">:</span> <span class="n">vitA</span><span class="p">,</span> <span class="s2">&quot;vitE&quot;</span><span class="p">:</span> <span class="n">vitE</span><span class="p">,</span> <span class="s2">&quot;calcium&quot;</span><span class="p">:</span> <span class="n">calcium</span><span class="p">,</span> <span class="s2">&quot;iron&quot;</span><span class="p">:</span> <span class="n">iron</span><span class="p">,</span> <span class="s2">&quot;potassium&quot;</span><span class="p">:</span> <span class="n">potassium</span><span class="p">,</span> <span class="s2">&quot;vitD_ul&quot;</span><span class="p">:</span><span class="n">vitD_ul</span><span class="p">,</span> <span class="s2">&quot;vitC_ul&quot;</span><span class="p">:</span><span class="n">vitC_ul</span><span class="p">,</span> <span class="s2">&quot;vitA_ul&quot;</span><span class="p">:</span><span class="n">vitA_ul</span><span class="p">,</span> <span class="s2">&quot;vitE_ul&quot;</span><span class="p">:</span><span class="n">vitE_ul</span><span class="p">,</span> <span class="s2">&quot;calcium_ul&quot;</span><span class="p">:</span><span class="n">calcium_ul</span><span class="p">,</span> <span class="s2">&quot;iron_ul&quot;</span><span class="p">:</span><span class="n">iron_ul</span><span class="p">}</span>

    <span class="c1"># post information to nutrition table in db</span>
    <span class="n">user_nutrition</span> <span class="o">=</span> <span class="n">UserNutrition</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">energy</span><span class="p">,</span> <span class="n">protein</span><span class="p">,</span> <span class="n">fat</span><span class="p">,</span> <span class="n">carbs</span><span class="p">,</span> <span class="n">calcium</span><span class="p">,</span> <span class="n">iron</span><span class="p">,</span> <span class="n">potassium</span><span class="p">,</span> <span class="n">calcium_ul</span><span class="p">,</span> <span class="n">iron_ul</span><span class="p">,</span> <span class="n">vitA</span><span class="p">,</span> <span class="n">vitD</span><span class="p">,</span><span class="n">vitC</span><span class="p">,</span><span class="n">vitE</span><span class="p">,</span> <span class="n">vitA_ul</span><span class="p">,</span> <span class="n">vitD_ul</span><span class="p">,</span><span class="n">vitC_ul</span><span class="p">,</span><span class="n">vitE_ul</span><span class="p">)</span>
    
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user_nutrition</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="s2">&quot;user nutrition posted&quot;</span></div>


<div class="viewcode-block" id="get_preferences"><a class="viewcode-back" href="../app.html#app.get_preferences">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_preferences/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_preferences</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a user&#39;s preferences from the database.</span>

<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A list of strings representing the user&#39;s preferences.</span>
<span class="sd">    :rtype: String list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">preferences</span> </div>

<div class="viewcode-block" id="get_restrictions"><a class="viewcode-back" href="../app.html#app.get_restrictions">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_restrictions/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_restrictions</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a user&#39;s dietary restrictions from the database.</span>

<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A list of strings representing the user&#39;s dietary restrictions.</span>
<span class="sd">    :rtype: String list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">restrictions</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">restrictions</span></div>

<div class="viewcode-block" id="get_recipe_list"><a class="viewcode-back" href="../app.html#app.get_recipe_list">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_recipe_list/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_recipe_list</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>
<span class="w">     </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve a list of recipes from Spoonacular based on a user&#39;s dietary preferences and restrictions.</span>

<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A JSON object representing recipes the user can choose from.</span>
<span class="sd">    :rtype: JSON</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># get restrictions and preferences</span>
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">restrictions</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    
    <span class="n">includes</span> <span class="o">=</span> <span class="s2">&quot;&amp;includeIngredients=&quot;</span><span class="o">+</span><span class="n">this_user</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="s2">&quot;&amp;excludeIngredients=&quot;</span><span class="o">+</span><span class="n">this_user</span><span class="o">.</span><span class="n">restrictions</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    
    <span class="c1"># make an array of all user diet info</span>
    <span class="c1"># in this format: [vegetarian, vegan, halal, kosher, gluten_free, dairy_free, lactose_int, low_sodium, low_carb, high_protein, keto, paleo]</span>
    <span class="n">diet_string</span> <span class="o">=</span><span class="s2">&quot;&amp;diet=&quot;</span>
    <span class="n">diet_types</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gluten_free</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,gluten free&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vegan</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,vegan&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">keto</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,ketogenic&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vegetarian</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,vegetarian&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">paleo</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,paleo&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">pescetarian</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,pescetarian&quot;</span>
        
    <span class="n">diet_string</span><span class="o">+=</span><span class="n">diet_types</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    
   <span class="c1">#user_diet = [this_user.vegetarian, this_user.vegan, this_user.halal, this_user.kosher, this_user.gluten_free, this_user.dairy_free, this_user.lactose_int, this_user.low_sodium, this_user.low_carb, this_user.high_protein, this_user.keto, this_user.paleo]</span>
    
    <span class="n">nutrients_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;http://localhost:5000/get_nutrition/</span><span class="si">{</span><span class="n">userID</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">nutrients_amounts</span> <span class="o">=</span> <span class="n">nutrients_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>

    <span class="c1"># first find recipes by nutrients</span>
    <span class="c1"># then remove recipes with restrictions</span>
    <span class="c1"># then select recipes with preferences</span>

    <span class="c1"># then get recipes that </span>

    <span class="c1"># may need to split up recipes for variety; do two or three get </span>
    <span class="c1"># requests from spoonacular each with less parameters, then </span>
    <span class="c1"># calculate each nutrients and do math until nutrients are satisfied</span>
    
    <span class="c1"># get recipes based on macros &amp; preferences</span>
    <span class="c1"># select 2-3 recipes for each week</span>
    <span class="c1"># use recipe ID to see what nutrients each recipe has</span>
    <span class="c1"># fill in rest of the recipes</span>

    <span class="c1">#nutrients_amounts = nutrients_amounts(userID)</span>

    <span class="n">energy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;energy&#39;</span><span class="p">])</span>
    <span class="n">protein</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;protein&#39;</span><span class="p">])</span>
    <span class="n">fat</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;fat&#39;</span><span class="p">])</span>
    <span class="n">carbs</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;carbs&#39;</span><span class="p">])</span>
    <span class="n">vitD</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitD&#39;</span><span class="p">])</span>
    <span class="n">vitC</span> <span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitC&#39;</span><span class="p">])</span>
    <span class="n">vitA</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitA&#39;</span><span class="p">])</span>
    <span class="n">vitE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitE&#39;</span><span class="p">])</span>
    <span class="n">calcium</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;calcium&#39;</span><span class="p">])</span>
    <span class="n">iron</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;iron&#39;</span><span class="p">])</span>
    <span class="n">potassium</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;potassium&#39;</span><span class="p">])</span>

    <span class="c1"># ULs</span>
    <span class="n">vitD_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitD_ul&#39;</span><span class="p">])</span>
    <span class="n">vitC_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitC_ul&#39;</span><span class="p">])</span>
    <span class="n">vitA_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitA_ul&#39;</span><span class="p">])</span>
    <span class="n">vitE_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;vitE_ul&#39;</span><span class="p">])</span>
    <span class="n">calcium_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;calcium_ul&#39;</span><span class="p">])</span>
    <span class="n">iron_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">nutrients_amounts</span><span class="p">[</span><span class="s1">&#39;iron_ul&#39;</span><span class="p">])</span>
    
    <span class="n">preferences</span> <span class="o">=</span> <span class="n">get_preferences</span><span class="p">(</span><span class="n">userID</span><span class="p">)</span>
    <span class="n">restriction</span> <span class="o">=</span> <span class="n">get_restrictions</span><span class="p">(</span><span class="n">userID</span><span class="p">)</span>
    
    <span class="n">find_by_nutrients_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/complexSearch&quot;</span>

    <span class="c1"># divide nutrients by 2 to account for lunch and dinner meals</span>
    
    <span class="c1"># ingredient preferences are randomized, includes will be added less than 20% of the time due to how much it limits the results</span>
    <span class="k">if</span><span class="p">(</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">0.2</span><span class="p">):</span>
        <span class="n">macros_query_params</span> <span class="o">=</span> <span class="s2">&quot;apiKey=&quot;</span> <span class="o">+</span> <span class="n">api_key</span> <span class="o">+</span> <span class="s2">&quot;&amp;number=30&amp;minProtein=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxProtein=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;minFat=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fat</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxFat=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fat</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxCarbs=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">carbs</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="n">diet_string</span><span class="o">+</span><span class="n">includes</span><span class="o">+</span><span class="n">excludes</span><span class="o">+</span><span class="s2">&quot;&amp;type=main course&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">macros_query_params</span> <span class="o">=</span> <span class="s2">&quot;apiKey=&quot;</span> <span class="o">+</span> <span class="n">api_key</span> <span class="o">+</span> <span class="s2">&quot;&amp;number=30&amp;minProtein=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxProtein=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">protein</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;minFat=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fat</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxFat=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">fat</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxCarbs=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">carbs</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span><span class="o">+</span><span class="n">diet_string</span><span class="o">+</span><span class="n">excludes</span><span class="o">+</span><span class="s2">&quot;&amp;type=main course&quot;</span>
    
    <span class="c1"># having the micronutrients in the query params makes it more constricting. so i am just going to let the user choose from list of recipes and then fill the rest of the nutrients in with snacks</span>

    <span class="n">macros_query</span> <span class="o">=</span>  <span class="n">find_by_nutrients_url</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">macros_query_params</span> 
    <span class="n">macros_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">macros_query</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">macros_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span></div>


<span class="c1"># just run this one function when user selects their recipes </span>
<div class="viewcode-block" id="get_remaining_ingredients"><a class="viewcode-back" href="../app.html#app.get_remaining_ingredients">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_remaining_ingredients/&lt;userID&gt;/&lt;weekID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;PUT&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span> <span class="c1"># this function gets remaining ingredients AND posts the final grocery list to the db</span>
<span class="k">def</span> <span class="nf">get_remaining_ingredients</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">weekID</span><span class="p">):</span>    
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    After calculating the remaining nutrients the user needs by subtracting nutrients received via user-chosen recipes from nutrients required for the user, this function finds snacks the user can eat to fulfill the remaining ingredients.</span>

<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>
<span class="sd">    :param integer weekID: An integer representing the unique identifier of the week.</span>

<span class="sd">    :return: A string indicating that the snacks have been successfully input into the database.</span>
<span class="sd">    :rtype: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># time start for function</span>
    <span class="c1"># time is in seconds</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>


    <span class="n">this_user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">preferences</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">preferences</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">restrictions</span> <span class="o">=</span> <span class="p">(</span><span class="n">this_user</span><span class="o">.</span><span class="n">restrictions</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    
    <span class="n">includes</span> <span class="o">=</span> <span class="s2">&quot;&amp;includeIngredients=&quot;</span><span class="o">+</span><span class="n">this_user</span><span class="o">.</span><span class="n">preferences</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="n">excludes</span> <span class="o">=</span> <span class="s2">&quot;&amp;excludeIngredients=&quot;</span><span class="o">+</span><span class="n">this_user</span><span class="o">.</span><span class="n">restrictions</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

    <span class="n">diet_string</span> <span class="o">=</span><span class="s2">&quot;&amp;diet=&quot;</span>
    <span class="n">diet_types</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">gluten_free</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,gluten free&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vegan</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,vegan&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">keto</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,ketogenic&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vegetarian</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,vegetarian&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">paleo</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,paleo&quot;</span>
    <span class="k">if</span> <span class="n">this_user</span><span class="o">.</span><span class="n">pescetarian</span><span class="p">:</span>
        <span class="n">diet_types</span><span class="o">+=</span><span class="s2">&quot;,pescetarian&quot;</span>
        
    <span class="n">diet_string</span><span class="o">+=</span><span class="n">diet_types</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

    <span class="c1"># get recipes IDs from the weekly recipes table</span>
    <span class="n">recipe_ids</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">,</span> <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="p">(</span><span class="n">recipe_ids</span><span class="o">.</span><span class="n">recipeIDs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>

    <span class="n">micronutrients</span> <span class="o">=</span> <span class="n">UserNutrition</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>

    <span class="n">energy</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">energy</span><span class="p">)</span>

    <span class="n">vitD</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitD</span><span class="p">)</span>
    <span class="n">vitC</span> <span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitC</span><span class="p">)</span>
    <span class="n">vitA</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitA</span><span class="p">)</span>
    <span class="n">vitE</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitE</span><span class="p">)</span>
    <span class="n">calcium</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">calcium</span><span class="p">)</span>
    <span class="n">iron</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">iron</span><span class="p">)</span>
    <span class="n">potassium</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">potassium</span><span class="p">)</span>

    <span class="c1"># ULs</span>
    <span class="n">vitD_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitD_ul</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">vitC_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitC_ul</span><span class="o">-</span><span class="mi">200</span><span class="p">)</span>
    <span class="n">vitA_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitA_ul</span><span class="o">-</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">vitE_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">vitE_ul</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">calcium_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">calcium_ul</span> <span class="o">-</span> <span class="mi">200</span><span class="p">)</span>
    <span class="n">iron_ul</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">micronutrients</span><span class="o">.</span><span class="n">iron_ul</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span>

    <span class="c1"># total nutrition (sum) from recipes</span>
    <span class="n">energy_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitD_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitC_sum</span> <span class="o">=</span><span class="mi">0</span>
    <span class="n">vitA_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitE_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">calcium_sum</span> <span class="o">=</span><span class="mi">0</span> 
    <span class="n">iron_sum</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">potassium_sum</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="c1"># one json object to hold all the nutrients in all the recipes</span>
    <span class="n">recipe_nutrition_info_json</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c1"># get nutrients of all the recipe IDs</span>
    <span class="k">for</span> <span class="n">recipe</span> <span class="ow">in</span> <span class="n">recipes</span><span class="p">:</span>
        <span class="n">recipe_nutrients_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;https://api.spoonacular.com/recipes/</span><span class="si">{</span><span class="n">recipe</span><span class="si">}</span><span class="s2">/nutritionWidget.json?apiKey=</span><span class="si">{</span><span class="n">api_key</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">recipe_nutrients_url</span><span class="p">)</span>
        <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">]</span><span class="o">=</span><span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="n">energy_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;bad&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">])):</span>
        
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Calcium&quot;</span><span class="p">:</span>
                <span class="n">calcium_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin C&quot;</span><span class="p">:</span>
                <span class="n">vitC_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin A&quot;</span><span class="p">:</span>
                <span class="n">vitA_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin E&quot;</span><span class="p">:</span>
                <span class="n">vitE_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin D&quot;</span><span class="p">:</span>
                <span class="n">vitD_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin D&quot;</span><span class="p">:</span>
                <span class="n">iron_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
            <span class="k">if</span> <span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;title&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Vitamin D&quot;</span><span class="p">:</span>
                <span class="n">potassium_sum</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_nutrition_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)][</span><span class="s2">&quot;good&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
        
    <span class="c1"># remaining nutrients</span>
    <span class="n">energy_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">energy</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">energy_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitD_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitD</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitD_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitC_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitC</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitC_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitA_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitA</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitA_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">vitE_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">vitE</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">vitE_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">calcium_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">calcium</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">calcium_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">iron_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">iron</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">iron_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">potassium_remaining</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">potassium</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">potassium_sum</span><span class="p">),</span> <span class="mi">2</span><span class="p">)</span>
    
    <span class="n">remaining_json</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy_remaining&quot;</span><span class="p">:</span><span class="n">energy_remaining</span><span class="p">,</span> <span class="s2">&quot;vitD_remaining&quot;</span><span class="p">:</span><span class="n">vitD_remaining</span><span class="p">,</span> <span class="s2">&quot;vitC_remaining&quot;</span><span class="p">:</span><span class="n">vitC_remaining</span><span class="p">,</span> <span class="s2">&quot;vitA_remaining&quot;</span><span class="p">:</span><span class="n">vitA_remaining</span><span class="p">,</span> <span class="s2">&quot;vitE_remaining&quot;</span><span class="p">:</span><span class="n">vitE_remaining</span><span class="p">,</span> <span class="s2">&quot;calcium_remaining&quot;</span><span class="p">:</span><span class="n">calcium_remaining</span><span class="p">,</span> <span class="s2">&quot;iron_remaining&quot;</span><span class="p">:</span><span class="n">iron_remaining</span><span class="p">,</span> <span class="s2">&quot;potassium_remaining&quot;</span><span class="p">:</span><span class="n">potassium_remaining</span><span class="p">}</span>
    
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">remaining_json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">remaining_json</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="c1">#return remaining_json</span>
    <span class="c1"># find the largest three nutrients they are missing</span>

    <span class="n">sorted_values</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">remaining_json</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">largest_values</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">remaining_json</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">sorted_values</span><span class="p">[:</span><span class="mi">2</span><span class="p">]:</span>
            <span class="n">largest_values</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="n">remaining_nutrients</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="c1"># nutrients to add in url query</span>

    <span class="n">nutrients_query</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">keys</span><span class="p">()))):</span>

        <span class="k">if</span> <span class="s2">&quot;energy&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minCalories=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxCalories=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;calcium&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minCalcium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxCalcium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">50</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;iron&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minIron=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxIron=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;potassium&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minPotassium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">250</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxPotassium=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">500</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitD&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminD=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">5</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminD=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitA&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminA=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">50</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminA=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitC&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminC=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminC=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">20</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;vitE&quot;</span> <span class="ow">in</span> <span class="n">remaining_nutrients</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
            <span class="n">nutrients_query</span> <span class="o">+=</span> <span class="s2">&quot;&amp;minVitaminE=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&amp;maxVitaminE=&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">((</span><span class="nb">float</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">largest_values</span><span class="o">.</span><span class="n">values</span><span class="p">())[</span><span class="n">i</span><span class="p">]))</span><span class="o">/</span><span class="mi">2</span><span class="o">+</span><span class="mi">5</span><span class="p">)</span>
    
    <span class="c1"># find snacks that fulfill these remaining nutrients</span>

    <span class="n">find_remaining_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/complexSearch&quot;</span>

    <span class="c1"># ingredient preferences are randomized, includes will be added less than 20% of the time due to how much it limits the results</span>
    <span class="n">micros_query_params</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">micros_query_params</span> <span class="o">=</span> <span class="s2">&quot;apiKey=&quot;</span> <span class="o">+</span> <span class="n">api_key</span> <span class="o">+</span> <span class="n">nutrients_query</span> <span class="o">+</span> <span class="n">diet_string</span><span class="o">+</span><span class="n">excludes</span><span class="o">+</span><span class="s2">&quot;&amp;number=30&amp;type=snack,drink,side dish,appetizer,salad,soup,fingerfood&quot;</span>

    <span class="n">micros_query</span> <span class="o">=</span>  <span class="n">find_remaining_url</span> <span class="o">+</span> <span class="s2">&quot;?&quot;</span> <span class="o">+</span> <span class="n">micros_query_params</span> 
    <span class="n">micros_response</span> <span class="o">=</span> <span class="p">(</span><span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">micros_query</span><span class="p">))</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="n">ids_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">micros_response</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">])):</span>
        <span class="n">ids_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">micros_response</span><span class="p">[</span><span class="s2">&quot;results&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;id&quot;</span><span class="p">])</span>

    <span class="c1"># choose at most two - no user choice</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ids_list</span><span class="p">)</span> <span class="o">&gt;</span><span class="mi">2</span><span class="p">:</span>
        <span class="n">ids_list</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">ids_list</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">ids_list_str</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">ids_list</span><span class="p">]</span>

    <span class="n">ids_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ids_list_str</span><span class="p">)</span>
    <span class="n">recipes_string</span> <span class="o">=</span> <span class="s1">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">recipes</span><span class="p">)</span>

    <span class="n">put_string</span> <span class="o">=</span> <span class="n">recipes_string</span> <span class="o">+</span> <span class="s2">&quot;,&quot;</span> <span class="o">+</span> <span class="n">ids_string</span>

    <span class="n">update</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">,</span> <span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span>
    <span class="n">update</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">recipeIDs</span> <span class="o">=</span> <span class="n">put_string</span><span class="p">))</span>

    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="c1"># time end for function</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="n">time_taken</span> <span class="o">=</span> <span class="n">Latency</span><span class="p">(</span><span class="s2">&quot;generate_remaining_recipes&quot;</span><span class="p">,</span> <span class="n">total_time</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">time_taken</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="c1"># post grocery list:</span>

    <span class="n">recipe_ids</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">,</span> <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="p">(</span><span class="n">recipe_ids</span><span class="o">.</span><span class="n">recipeIDs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    
    <span class="n">num_recipes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recipes</span><span class="p">)</span>
    
    <span class="n">recipe_ingredients_info_json</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="n">find_by_nutrients_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/</span><span class="si">{id}</span><span class="s2">/ingredientWidget.json?apiKey=13cc54269ca54d258cf7b07e4383154c&quot;</span>
    
    <span class="n">grocery_list_map</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">recipe</span> <span class="ow">in</span> <span class="n">recipes</span><span class="p">:</span>
        <span class="n">add</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/ingredientWidget.json?apiKey=13cc54269ca54d258cf7b07e4383154c&quot;</span>
        <span class="n">add_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
        <span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)]</span> <span class="o">=</span> <span class="n">add_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">])):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">grocery_list_map</span><span class="p">):</span>
                
                <span class="c1"># then add to already existing amount</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                
                <span class="n">add</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">num_recipes</span><span class="p">)</span>
                
                <span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">])</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">num_recipes</span><span class="p">)</span>
                <span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">add</span> <span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">])</span>
    
    <span class="c1">#return json.dumps(grocery_list_map)</span>
    <span class="c1"># post information to nutrition table in db</span>
    <span class="n">post_grocery_list</span> <span class="o">=</span> <span class="n">GroceryLists</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">weekID</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">grocery_list_map</span><span class="p">))</span>
  
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">post_grocery_list</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="s2">&quot;recipe to fill nutrient requirement added and grocery list is posted&quot;</span></div>
    
<div class="viewcode-block" id="post_grocery_list"><a class="viewcode-back" href="../app.html#app.post_grocery_list">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/post_grocery_list/&lt;userID&gt;/&lt;weekID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">,</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">post_grocery_list</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">weekID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Posts into database the ingredients of the recipes the user chose. </span>
<span class="sd">    </span>
<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>
<span class="sd">    :param integer weekID: An integer representing the unique identifier of the week.</span>

<span class="sd">    :return: A string indicating that the ingredients have been successfully input into the database.</span>
<span class="sd">    :rtype: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># time start for function</span>
    <span class="c1"># time is in seconds</span>
    <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="c1">###</span>
    <span class="n">recipe_ids</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">,</span> <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">recipes</span> <span class="o">=</span> <span class="p">(</span><span class="n">recipe_ids</span><span class="o">.</span><span class="n">recipeIDs</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    
    <span class="n">num_recipes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">recipes</span><span class="p">)</span>
    
    <span class="n">recipe_ingredients_info_json</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="n">find_by_nutrients_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/</span><span class="si">{id}</span><span class="s2">/ingredientWidget.json?apiKey=13cc54269ca54d258cf7b07e4383154c&quot;</span>
    
    <span class="n">grocery_list_map</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="k">for</span> <span class="n">recipe</span> <span class="ow">in</span> <span class="n">recipes</span><span class="p">:</span>
        <span class="n">add</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/ingredientWidget.json?apiKey=13cc54269ca54d258cf7b07e4383154c&quot;</span>
        <span class="n">add_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">add</span><span class="p">)</span>
        <span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe</span><span class="p">)]</span> <span class="o">=</span> <span class="n">add_response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">])):</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])</span> <span class="ow">in</span> <span class="n">grocery_list_map</span><span class="p">):</span>
                
                <span class="c1"># then add to already existing amount</span>
                <span class="n">temp</span> <span class="o">=</span> <span class="nb">float</span><span class="p">((</span><span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])])</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
                
                <span class="n">add</span> <span class="o">=</span> <span class="n">temp</span> <span class="o">+</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">num_recipes</span><span class="p">)</span>
                
                <span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">add</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span><span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">])</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="n">add</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;value&quot;</span><span class="p">])</span><span class="o">*</span><span class="p">(</span><span class="mi">7</span><span class="o">/</span><span class="n">num_recipes</span><span class="p">)</span>
                <span class="n">grocery_list_map</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;name&quot;</span><span class="p">])]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">add</span> <span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">recipe_ingredients_info_json</span><span class="p">[</span><span class="n">recipe</span><span class="p">][</span><span class="s2">&quot;ingredients&quot;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="s2">&quot;amount&quot;</span><span class="p">][</span><span class="s2">&quot;us&quot;</span><span class="p">][</span><span class="s2">&quot;unit&quot;</span><span class="p">])</span>
    
    
    <span class="c1">#return json.dumps(grocery_list_map)</span>
    <span class="c1"># post information to nutrition table in db</span>
    <span class="n">post_grocery_list</span> <span class="o">=</span> <span class="n">GroceryLists</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">weekID</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">grocery_list_map</span><span class="p">))</span>
  
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">post_grocery_list</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="c1"># time end for function</span>
    <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

    <span class="n">time_taken</span> <span class="o">=</span> <span class="n">Latency</span><span class="p">(</span><span class="s2">&quot;generate_grocery_list&quot;</span><span class="p">,</span> <span class="n">total_time</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">time_taken</span><span class="p">)</span>
    <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

    <span class="k">return</span> <span class="s2">&quot;grocery list added to database&quot;</span> <span class="c1"># weekly</span></div>


<div class="viewcode-block" id="get_grocery_list"><a class="viewcode-back" href="../app.html#app.get_grocery_list">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_grocery_list/&lt;userID&gt;/&lt;weekID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_grocery_list</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">weekID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the grocery list from database for a given user for a given week. </span>
<span class="sd">    </span>
<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>
<span class="sd">    :param integer weekID: An integer representing the unique identifier of the week.</span>

<span class="sd">    :return: A dictionary containing the grocery list.</span>
<span class="sd">    :rtype: Dictionary</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">get</span> <span class="o">=</span>  <span class="n">GroceryLists</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">,</span> <span class="n">web_week_number</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">weekID</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">get_grocery_list</span> <span class="o">=</span> <span class="n">get</span><span class="o">.</span><span class="n">grocery_list</span>
    <span class="n">grocery_dict</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">get_grocery_list</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">grocery_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">grocery_dict</span></div>

<div class="viewcode-block" id="get_num_weeks"><a class="viewcode-back" href="../app.html#app.get_num_weeks">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_num_weeks/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_num_weeks</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the number of weeks a particular user has been active. </span>
<span class="sd">    </span>
<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A string of the number of weeks.</span>
<span class="sd">    :rtype: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">web_week_number</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">get</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_created_date"><a class="viewcode-back" href="../app.html#app.get_created_date">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_created_date/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_created_date</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves the date the user was created. </span>
<span class="sd">    </span>
<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A string of user creation date.</span>
<span class="sd">    :rtype: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">get</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">created</span> <span class="o">=</span> <span class="n">get</span><span class="o">.</span><span class="n">created_on</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">created</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span></div>

<div class="viewcode-block" id="get_user_grocery_lists"><a class="viewcode-back" href="../app.html#app.get_user_grocery_lists">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/get_user_grocery_lists/&lt;userID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">get_user_grocery_lists</span><span class="p">(</span><span class="n">userID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieves all the grocery lists of the user. </span>
<span class="sd">    </span>
<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>

<span class="sd">    :return: A hash map containing the week number and the grocery list corresponding to that week number.</span>
<span class="sd">    :rtype: Hash map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1">#grocery_lists_dict = {}</span>
    
    <span class="n">get_gl</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">GroceryLists</span><span class="o">.</span><span class="n">grocery_list</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">get_gl_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">get_gl</span><span class="p">]</span>
    
    <span class="n">get_weeks</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">GroceryLists</span><span class="o">.</span><span class="n">web_week_number</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
    <span class="n">get_weeks_json</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">get_weeks</span><span class="p">]</span>
    <span class="c1">#return(str(json_values))</span>
    
    <span class="n">hash_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">get_weeks_json</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">get_gl_json</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">get_weeks_json</span><span class="p">))}</span>
    
    <span class="k">return</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">hash_map</span><span class="p">))</span></div>

<div class="viewcode-block" id="accuracy"><a class="viewcode-back" href="../app.html#app.accuracy">[docs]</a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/accuracy/&lt;userID&gt;/&lt;weekID&gt;&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GET&#39;</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">userID</span><span class="p">,</span> <span class="n">weekID</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates how accurately the user&#39;s chosen recipes fulfill their nutritional requirements. </span>
<span class="sd">    </span>
<span class="sd">    :param integer userID: An integer representing the unique identifier of the user.</span>
<span class="sd">    :param integer weekID: An integer representing the unique identifier of the week.</span>

<span class="sd">    :return: A string of the percentage of the user&#39;s nutritional needs met by the chosen recipes.</span>
<span class="sd">    :rtype: String</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># calculate user requirements</span>
    <span class="n">this_user</span> <span class="o">=</span> <span class="n">UserNutrition</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">nutrition_required</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">energy</span><span class="p">,</span> <span class="s2">&quot;protein&quot;</span><span class="p">:</span><span class="n">this_user</span><span class="o">.</span><span class="n">protein</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">fat</span><span class="p">,</span> <span class="s2">&quot;carbs&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">carbs</span><span class="p">,</span> <span class="s2">&quot;vitD&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitD</span><span class="p">,</span> <span class="s2">&quot;vitC&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitC</span><span class="p">,</span> <span class="s2">&quot;vitA&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitA</span><span class="p">,</span> <span class="s2">&quot;vitE&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">vitE</span><span class="p">,</span> <span class="s2">&quot;calcium&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">calcium</span><span class="p">,</span> <span class="s2">&quot;iron&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">iron</span><span class="p">,</span> <span class="s2">&quot;potassium&quot;</span><span class="p">:</span> <span class="n">this_user</span><span class="o">.</span><span class="n">potassium</span><span class="p">}</span>
    
    <span class="c1"># calcualte recipes nutrition</span>
    <span class="n">user_recipes</span> <span class="o">=</span> <span class="n">WeeklyRecipes</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">userID</span> <span class="o">=</span> <span class="n">userID</span><span class="p">,</span> <span class="n">web_week_number</span> <span class="o">=</span> <span class="n">weekID</span><span class="p">)</span><span class="o">.</span><span class="n">one</span><span class="p">()</span>
    <span class="n">recipes_list</span> <span class="o">=</span> <span class="n">user_recipes</span><span class="o">.</span><span class="n">recipeIDs</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span>
    <span class="n">recipe_nutrition_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recipes_list</span><span class="p">)):</span>
        <span class="nb">id</span> <span class="o">=</span> <span class="n">recipes_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">find_nutrients_url</span> <span class="o">=</span> <span class="s2">&quot;https://api.spoonacular.com/recipes/&quot;</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">id</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;/nutritionWidget.json?apiKey=&quot;</span> <span class="o">+</span> <span class="n">api_key</span>
        <span class="n">macros_response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">find_nutrients_url</span><span class="p">)</span>
        <span class="n">recipe_nutrition_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">macros_response</span><span class="o">.</span><span class="n">json</span><span class="p">())</span>
    
    <span class="n">calories_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">protein_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fat_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">carbs_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitD_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitC_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitA_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">vitE_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">calcium_total</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">iron_total</span> <span class="o">=</span><span class="mi">0</span>
    <span class="n">potassium_total</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="c1">#re.sub(&#39;\p{L}&#39;, &#39;&#39;, string, flags=re.UNICODE)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">recipe_nutrition_list</span><span class="p">)):</span>
        
        <span class="c1">#calories_total += float(recipe_nutrition_list[i][&quot;bad&quot;][0][&quot;amount&quot;])</span>
        <span class="n">cal</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;bad&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Calories&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cal_temp</span> <span class="o">=</span> <span class="n">cal</span> <span class="k">if</span> <span class="n">cal</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">calories_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cal_temp</span><span class="p">)))</span>

        <span class="n">pr</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Protein&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">pr_temp</span> <span class="o">=</span> <span class="n">pr</span> <span class="k">if</span> <span class="n">pr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">protein_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pr_temp</span><span class="p">)))</span>
        
        <span class="n">ft</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;bad&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Fat&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ft_temp</span> <span class="o">=</span> <span class="n">ft</span> <span class="k">if</span> <span class="n">ft</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">fat_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ft_temp</span><span class="p">)))</span>
        
        <span class="n">cb</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;bad&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Carbohydrates&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cb_temp</span> <span class="o">=</span> <span class="n">cb</span> <span class="k">if</span> <span class="n">cb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">carbs_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cb_temp</span><span class="p">)))</span>

        <span class="n">vD</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vitamin D&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">vD_temp</span> <span class="o">=</span> <span class="n">vD</span> <span class="k">if</span> <span class="n">vD</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">vitD_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vD_temp</span><span class="p">)))</span>

        <span class="n">vC</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vitamin C&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">vC_temp</span> <span class="o">=</span> <span class="n">vC</span> <span class="k">if</span> <span class="n">vC</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">vitC_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vC_temp</span><span class="p">)))</span>
        
        <span class="n">vA</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vitamin A&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">vA_temp</span> <span class="o">=</span> <span class="n">vA</span> <span class="k">if</span> <span class="n">vA</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">vitA_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vA_temp</span><span class="p">)))</span>
 
        <span class="n">vE</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Vitamin E&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">vE_temp</span> <span class="o">=</span> <span class="n">vE</span> <span class="k">if</span> <span class="n">vE</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">vitE_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">vE_temp</span><span class="p">)))</span>
        
        <span class="n">cc</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Calcium&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">cc_temp</span> <span class="o">=</span> <span class="n">cc</span> <span class="k">if</span> <span class="n">cc</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">calcium_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">cc_temp</span><span class="p">)))</span>
        
        <span class="n">ir</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Iron&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">ir_temp</span> <span class="o">=</span> <span class="n">ir</span> <span class="k">if</span> <span class="n">ir</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">iron_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">ir_temp</span><span class="p">)))</span>
        
        <span class="n">pt</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">recipe_nutrition_list</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="s1">&#39;good&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">item</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Potassium&#39;</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">pt_temp</span> <span class="o">=</span> <span class="n">pt</span> <span class="k">if</span> <span class="n">pt</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="n">potassium_total</span> <span class="o">+=</span> <span class="nb">float</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;\D&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">pt_temp</span><span class="p">)))</span>
        
    <span class="n">nutrition_actual</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;energy&quot;</span><span class="p">:</span><span class="n">calories_total</span><span class="p">,</span> <span class="s2">&quot;protein&quot;</span><span class="p">:</span><span class="n">protein_total</span><span class="p">,</span> <span class="s2">&quot;fat&quot;</span><span class="p">:</span> <span class="n">fat_total</span><span class="p">,</span> <span class="s2">&quot;carbs&quot;</span><span class="p">:</span> <span class="n">carbs_total</span><span class="p">,</span> <span class="s2">&quot;vitD&quot;</span><span class="p">:</span> <span class="n">vitD_total</span><span class="p">,</span> <span class="s2">&quot;vitC&quot;</span><span class="p">:</span> <span class="n">vitC_total</span><span class="p">,</span> <span class="s2">&quot;vitA&quot;</span><span class="p">:</span> <span class="n">vitA_total</span><span class="p">,</span> <span class="s2">&quot;vitE&quot;</span><span class="p">:</span> <span class="n">vitE_total</span><span class="p">,</span> <span class="s2">&quot;calcium&quot;</span><span class="p">:</span> <span class="n">calcium_total</span><span class="p">,</span> <span class="s2">&quot;iron&quot;</span><span class="p">:</span> <span class="n">iron_total</span><span class="p">,</span> <span class="s2">&quot;potassium&quot;</span><span class="p">:</span> <span class="n">potassium_total</span><span class="p">}</span>
    
    <span class="c1"># calculate differences</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nutrition_actual</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">nutrition_required</span> <span class="ow">and</span> <span class="n">nutrition_actual</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">!=</span> <span class="n">nutrition_required</span><span class="p">[</span><span class="n">key</span><span class="p">]:</span>
            <span class="n">diff</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">nutrition_required</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">-</span> <span class="n">nutrition_actual</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
    
    <span class="c1"># quantify it</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">diff</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            
    <span class="n">total</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">diff</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

    <span class="c1"># compute the number of values</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>

    <span class="c1"># compute the average</span>
    <span class="n">average</span> <span class="o">=</span> <span class="n">total</span> <span class="o">/</span> <span class="n">count</span>
    <span class="n">ret</span> <span class="o">=</span> <span class="n">average</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">average</span> <span class="o">&gt;</span> <span class="mi">100</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="mi">80</span>  <span class="o">+</span> <span class="p">((</span><span class="n">average</span><span class="o">-</span><span class="mi">100</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">average</span> <span class="o">&lt;</span> <span class="mi">80</span><span class="p">):</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">average</span> <span class="o">+</span> <span class="p">(</span><span class="mi">20</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
    
    
    
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">ret</span><span class="p">))</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Ninetails.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>